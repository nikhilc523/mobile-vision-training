# Algorithm Flowchart: Fall Detection System

**Project:** Mobile Vision Fall Detection  
**Date:** October 30, 2025  
**Purpose:** Visual representation of the complete fall detection algorithm

---

## Complete System Flowchart

```
┌─────────────────────────────────────────────────────────────────────┐
│                         START: Video Frame Input                     │
│                    (Smartphone Camera @ 30-60 FPS)                   │
└────────────────────────────────┬────────────────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  Read Frame from       │
                    │  Camera/Video Stream   │
                    └────────────┬───────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │  Convert BGR → RGB     │
                    └────────────┬───────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    STAGE 1: POSE ESTIMATION (YOLO)                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  YOLO11n-Pose Inference                                 │        │
│  │  • Input: RGB frame (H×W×3)                             │        │
│  │  • Model: yolo11n-pose.pt (6 MB)                        │        │
│  │  • Speed: 50 FPS (20ms per frame)                       │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Extract Keypoints                                      │        │
│  │  • 17 keypoints (COCO format)                           │        │
│  │  • Each: (x, y, confidence)                             │        │
│  │  • Multi-person support (use first person)              │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Normalize Coordinates                                  │        │
│  │  • x_norm = x / frame_width                             │        │
│  │  • y_norm = y / frame_height                            │        │
│  │  • Range: [0, 1]                                        │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Apply Confidence Masking                               │        │
│  │  • Threshold: 0.3                                       │        │
│  │  • If conf < 0.3: set (x, y) = (0, 0)                  │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Swap Coordinates: (x, y) → (y, x)                     │        │
│  │  • Match MoveNet format for compatibility               │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
└───────────────────────────┼──────────────────────────────────────────┘
                            │
                            ▼
              Output: keypoints (17, 3) [y, x, conf]
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│              STAGE 2: FEATURE EXTRACTION (Raw Keypoints)             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Extract Y, X Coordinates                               │        │
│  │  • Ignore confidence values                             │        │
│  │  • Extract: keypoints[:, :2]                            │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Flatten to 1D Vector                                   │        │
│  │  • Shape: (17, 2) → (34,)                               │        │
│  │  • Features: [y0, x0, y1, x1, ..., y16, x16]           │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
└───────────────────────────┼──────────────────────────────────────────┘
                            │
                            ▼
                Output: features (34,)
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                 STAGE 3: ROLLING WINDOW BUFFER                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Append Features to Buffer                              │        │
│  │  • buffer.append(features)                              │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Check Buffer Size                                      │        │
│  │  • If len(buffer) > 30: buffer.pop(0)                  │        │
│  │  • Maintain exactly 30 frames (1 second)                │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│                  ┌────────────────┐                                 │
│                  │ len(buffer)    │                                 │
│                  │    == 30?      │                                 │
│                  └────┬──────┬────┘                                 │
│                       │ NO   │ YES                                  │
│                       │      │                                      │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Proceed to LSTM      │                  │
│              │ (wait) │  │ Inference            │                  │
│              └────────┘  └──────────┬───────────┘                  │
│                                     │                               │
└─────────────────────────────────────┼───────────────────────────────┘
                                      │
                                      ▼
                    Output: window (30, 34)
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────┐
│           STAGE 4: TEMPORAL ANALYSIS (BiLSTM Classifier)             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Reshape Window                                         │        │
│  │  • Shape: (30, 34) → (1, 30, 34)                       │        │
│  │  • Add batch dimension                                  │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  BiLSTM Layer 1 (64 units)                             │        │
│  │  • Bidirectional processing                             │        │
│  │  • Forward: Past → Present                              │        │
│  │  • Backward: Future → Present                           │        │
│  │  • Output: (1, 30, 128)                                 │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  BiLSTM Layer 2 (32 units)                             │        │
│  │  • Bidirectional processing                             │        │
│  │  • return_sequences=False                               │        │
│  │  • Output: (1, 64)                                      │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Dropout (30%)                                          │        │
│  │  • Regularization (training only)                       │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Dense Layer (32 units, ReLU)                          │        │
│  │  • Fully connected                                      │        │
│  │  • Output: (1, 32)                                      │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Output Layer (1 unit, Sigmoid)                        │        │
│  │  • Fall probability [0, 1]                              │        │
│  │  • Output: (1, 1)                                       │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
└───────────────────────────┼──────────────────────────────────────────┘
                            │
                            ▼
              Output: probability (0.0 to 1.0)
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│              STAGE 5: POST-PROCESSING & FILTERING                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Filter 1: Threshold Check                             │        │
│  │  • Is probability > 0.85?                               │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │ prob > 0.85?    │                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Continue to Filter 2 │                  │
│              │ NO FALL│  └──────────┬───────────┘                  │
│              └────────┘             │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Filter 2: Height Ratio Check                          │        │
│  │  • Calculate EMA height ratio                           │        │
│  │  • Is EMA_height < 0.66?                                │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │ height < 0.66?  │                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Continue to Filter 3 │                  │
│              │ NO FALL│  └──────────┬───────────┘                  │
│              └────────┘             │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Filter 3: Angle Check                                 │        │
│  │  • Calculate torso angle                                │        │
│  │  • Is angle ≥ 35°?                                      │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │  angle ≥ 35°?   │                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Continue to Filter 4 │                  │
│              │ NO FALL│  └──────────┬───────────┘                  │
│              └────────┘             │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Filter 4: Consecutive Frames                          │        │
│  │  • Increment consecutive_count                          │        │
│  │  • Is consecutive_count ≥ 3?                            │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │  count ≥ 3?     │                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Continue to FSM      │                  │
│              │ (wait) │  └──────────┬───────────┘                  │
│              └────────┘             │                               │
│                                     │                               │
└─────────────────────────────────────┼───────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────┐
│           STAGE 6: FSM VERIFICATION (Physics-Inspired)               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  FSM State 1: STANDING (Initial)                       │        │
│  │  • Calculate vertical velocity                          │        │
│  │  • v = (hip_y_current - hip_y_prev) × fps              │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │  v < -0.12?     │                                │
│                  │ (Rapid Descent) │                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Transition to        │                  │
│              │ NO FALL│  │ DESCENDING State     │                  │
│              └────────┘  └──────────┬───────────┘                  │
│                                     │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  FSM State 2: DESCENDING                               │        │
│  │  • Calculate torso angle                                │        │
│  │  • α = arctan2(dx, dy) × 180/π                         │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │   α ≥ 40°?      │                                │
│                  │(Orientation Flip)│                               │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Return │  │ Transition to        │                  │
│              │ NO FALL│  │ HORIZONTAL State     │                  │
│              └────────┘  └──────────┬───────────┘                  │
│                                     │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  FSM State 3: HORIZONTAL                               │        │
│  │  • Calculate movement magnitude                         │        │
│  │  • m = ||keypoints_current - keypoints_prev||          │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │  m ≤ 0.02?      │                                │
│                  │  (Stillness)    │                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │ Reset  │  │ Increment            │                  │
│              │ Counter│  │ stillness_counter    │                  │
│              └────────┘  └──────────┬───────────┘                  │
│                                     │                               │
│                                     ▼                               │
│                          ┌──────────────────┐                       │
│                          │ stillness_counter│                       │
│                          │     ≥ 12?        │                       │
│                          └────┬──────┬──────┘                       │
│                               │ NO   │ YES                          │
│                               ▼      ▼                              │
│                      ┌────────┐  ┌──────────────────┐              │
│                      │ Return │  │ Transition to    │              │
│                      │ (wait) │  │ ON_GROUND State  │              │
│                      └────────┘  └──────┬───────────┘              │
│                                         │                           │
│                                         ▼                           │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  FSM State 4: ON_GROUND                                │        │
│  │  • FALL VERIFIED! ✓                                     │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
└───────────────────────────┼──────────────────────────────────────────┘
                            │
                            ▼
                    FALL DETECTED! 🚨
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    STAGE 7: ALERT SYSTEM                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Level 1: Immediate Notification                       │        │
│  │  • Send push notification                               │        │
│  │  • Title: "🚨 FALL DETECTED!"                          │        │
│  │  • Body: "Confidence: XX% at HH:MM:SS"                 │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Save Video Clip                                        │        │
│  │  • 10 seconds before fall                               │        │
│  │  • 10 seconds after fall                                │        │
│  │  • Total: 20 second clip                                │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Wait 10 Seconds                                        │        │
│  │  • Check if person still on ground                      │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │ Still on ground?│                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │  END   │  │ Level 2: SMS Alert   │                  │
│              └────────┘  └──────────┬───────────┘                  │
│                                     │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Send SMS to Emergency Contacts                        │        │
│  │  • Message: "Fall detected at HH:MM:SS"                │        │
│  │  • Include location (if available)                      │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                           ▼                                          │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Wait 20 More Seconds                                  │        │
│  │  • Check if person still on ground                      │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
│                  ┌────────┴────────┐                                │
│                  │ Still on ground?│                                │
│                  └────┬──────┬─────┘                                │
│                       │ NO   │ YES                                  │
│                       ▼      ▼                                      │
│              ┌────────┐  ┌──────────────────────┐                  │
│              │  END   │  │ Level 3: Emergency   │                  │
│              └────────┘  │ Call                 │                  │
│                          └──────────┬───────────┘                  │
│                                     │                               │
│                                     ▼                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  Call Emergency Services                               │        │
│  │  • Automated call to 911 / emergency number             │        │
│  │  • Play pre-recorded message                            │        │
│  │  • Provide location                                     │        │
│  └────────────────────────┬────────────────────────────────┘        │
│                           │                                          │
└───────────────────────────┼──────────────────────────────────────────┘
                            │
                            ▼
                          END
```

---

## FSM State Transition Diagram

```
                    ┌──────────────┐
                    │   STANDING   │ ◄─── Initial State
                    │  (State 0)   │
                    └──────┬───────┘
                           │
                           │ v < -0.12
                           │ (Rapid Descent)
                           ▼
                    ┌──────────────┐
                    │  DESCENDING  │
                    │  (State 1)   │
                    └──────┬───────┘
                           │
                           │ α ≥ 40°
                           │ (Orientation Flip)
                           ▼
                    ┌──────────────┐
                    │  HORIZONTAL  │
                    │  (State 2)   │
                    └──────┬───────┘
                           │
                           │ m ≤ 0.02 for 12 frames
                           │ (Stillness)
                           ▼
                    ┌──────────────┐
                    │  ON_GROUND   │ ◄─── FALL VERIFIED!
                    │  (State 3)   │
                    └──────────────┘
```

---

## BiLSTM Architecture Diagram

```
Input Window (30, 34)
       │
       ▼
┌──────────────────────────────────────┐
│   BiLSTM Layer 1 (64 units)          │
│                                      │
│   Forward LSTM  ──────────────►      │
│   [h1, h2, ..., h30]                 │
│                                      │
│   Backward LSTM ◄──────────────      │
│   [h30, h29, ..., h1]                │
│                                      │
│   Concatenate: [forward, backward]   │
│   Output: (30, 128)                  │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│   BiLSTM Layer 2 (32 units)          │
│                                      │
│   Forward LSTM  ──────────────►      │
│   Backward LSTM ◄──────────────      │
│                                      │
│   Concatenate: [forward, backward]   │
│   Output: (64,)                      │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│   Dropout (30%)                      │
│   • Regularization                   │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│   Dense Layer (32 units, ReLU)      │
│   • Fully connected                  │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│   Output Layer (1 unit, Sigmoid)    │
│   • Fall probability [0, 1]          │
└──────────────┬───────────────────────┘
               │
               ▼
         Probability
```

---

## Temporal Pattern Recognition

**What BiLSTM Learns:**

```
Time:     t-1s    t-0.5s    t=0      t+0.5s   t+1s
          │       │         │        │        │
Standing: ████    ████      ████     ████     ████
          │       │         │        │        │
          │       │         ▼        │        │
Falling:  ████    ████      ▓▓▓▓     ░░░░     ░░░░
          │       │         │        │        │
          │       │         │        ▼        │
On Ground:████    ████      ████     ░░░░     ░░░░
          │       │         │        │        │
          
Legend:
████ = High keypoint confidence (standing)
▓▓▓▓ = Medium confidence (transitioning)
░░░░ = Low height (on ground)

BiLSTM Pattern:
- Standing:  High hip position, vertical torso, stable
- Falling:   Rapid hip descent, torso rotation, high velocity
- On Ground: Low hip position, horizontal torso, stillness
```

---

**End of Algorithm Flowchart Documentation**

